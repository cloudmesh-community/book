<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Unknown </title></head><body>
<h1 id="dockerfile-secdocker-file">Dockerfile {#sec:docker-file}</h1>
<p>In order for us to build containers, we need to know what is in the
container and how to create an image representing a container. To do
this a convenient specification format called <code>Dockerfile</code> can be
used. Once a <code>Dockerfile</code> is created, we can build images from it</p>
<p>We showcase here the use of a dockerfile on a simple example using a
REST service.</p>
<p>This example is copied from the official docker documentation hosted
at</p>
<ul>
<li><a href="https://docs.docker.com/get-started/part2/#publish-the-image">https://docs.docker.com/get-started/part2/#publish-the-image</a></li>
</ul>
<h2 id="specification">Specification</h2>
<p>It os best to start with an empty directory in which we create a
Dockerfile.</p>
<p><code>bash
local$ mkdir ~/cloudmesh/docker
local$ cd ~/cloudmesh/docker</code></p>
<p>Next, we create an empty file called <code>Dockerfile</code></p>
<p><code>bash
local$ touch Dockerfile</code></p>
<p>We copy the following contents into the Dockerfile and after that
create a simple REST service</p>
<p>```dockerfile</p>
<h1 id="use-an-official-python-runtime-as-a-parent-image">Use an official Python runtime as a parent image</h1>
<p>FROM python:3.7-slim</p>
<h1 id="set-the-working-directory-to-app">Set the working directory to /app</h1>
<p>WORKDIR /app</p>
<h1 id="copy-the-current-directory-contents-into-the-container-at-app">Copy the current directory contents into the container at /app</h1>
<p>COPY . /app</p>
<h1 id="install-any-needed-packages-specified-in-requirementstxt">Install any needed packages specified in requirements.txt</h1>
<p>RUN pip install --trusted-host pypi.python.org -r requirements.txt</p>
<h1 id="make-port-80-available">Make port 80 available</h1>
<p>EXPOSE 80</p>
<h1 id="run-apppy-when-the-container-launches">Run app.py when the container launches</h1>
<p>CMD ["python", "app.py"]
```</p>
<p>We also create a <code>requirements.txt</code> file that we need for installing the
necessary python packages</p>
<pre><code>Flask
</code></pre>
<p>The example application we use here is a student info served via a
RESTful service implemented using python flask.
It is stored in the file app.py</p>
<p>```python
from flask import Flask, jsonify
import os</p>
<p>app = Flask(<strong>name</strong>)</p>
<p>@app.route('/student/albert')
def alberts_information():
    data = {
        'firstname': 'Albert',
        'lastname': 'Zweistsein',
        'university': 'Indiana University',
        'email': 'albert@example.com'
        }
    return jsonify(**data)</p>
<p>if <strong>name</strong> == '<strong>main</strong>':
    app.run(host="0.0.0.0", port=80)
```</p>
<p>To build the container, we can use the following command:</p>
<p><code>bash
local$ docker build -t students .</code></p>
<p>To run the service open a new window and cd into the directory where
you code is located. Now say</p>
<p><code>bash
local$ docker run -d -p 4000:80 students</code></p>
<p>Your docker container will run and you can visit it by using the
command</p>
<p><code>bash
local$ curl http://localhost:4000/student/albert</code></p>
<p>To stop the container do a</p>
<p><code>bash
local$ docker ps</code></p>
<p>and locate the id of the container, e.g., 2a19776ab812, and then run this </p>
<p><code>bash
local$ docker stop 2a19776ab812</code></p>
<p>To delete the docker container image, you must first sop all instances
using it and the remove the image. You can see the images with the
command </p>
<p><code>bash
local$ docker images</code></p>
<p>Then you can locate all containers using that image while looking in
the IMAGE column or using a simple fgrep in case you have many
images. stop the containers using that image and that you can say</p>
<p><code>bash
local$ docker rm 74b9b994c9bd</code></p>
<p>while the number is the container id</p>
<p>Once you killed all containers using that image, you can remove the
image with the <code>rmi</code> command.</p>
<p><code>bash
local$ docker rmi 8b3246425402</code></p>
<h2 id="references">References</h2>
<p>The reference documentation about docker files can be found at </p>
<ul>
<li><a href="https://docs.docker.com/engine/reference/builder/">https://docs.docker.com/engine/reference/builder/</a></li>
</ul>
</body></html>